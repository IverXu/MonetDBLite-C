@f MultiPointLineString
@A C.W. Quak
@h
#ifndef __MULTIPOINTLINESTRING_H__
#define __MULTIPOINTLINESTRING_H__

extern bool Relate(const MultiPoint& p,const LineString& l,const char matrix[9]);
extern relationship Relate(const MultiPoint& p,const LineString& l);

#endif /* __MULTIPOINTLINESTRING_H__ */
@C
#include "geometry.h"
#include "opengis.h"

//
//===============================================
// Dimensionally Extended Nine-Intersection Model
//===============================================
//
static bool calc_345678(
   const MultiPoint& /* p */,
   const LineString& /* l*/,
   relmatrix& rel)
{
   rel.setdimension(3,-1);
   rel.setdimension(4,-1);
   rel.setdimension(5,-1);
   rel.setdimension(6,1);
   rel.setdimension(7,0);
   rel.setdimension(8,2);

   return (rel.isfalse(3) || rel.isfalse(4) || rel.isfalse(5) || rel.isfalse(6) || rel.isfalse(7) || rel.isfalse(8));
}

static bool calc_012(
   const MultiPoint&  p,
   const LineString& l,
   relmatrix& rel)
{
   //
   // Calculate the boundary of the LineString.
   //
   multipoint* m = l.boundary();

   if (intersect(p,*m))
      if (rel.setdimension(1,0))
         return(true);
   else
      if (rel.setdimension(1,-1))
         return(true);
   

   rel.setdimension(0,-1);
   rel.setdimension(2,-1);
   for(int i=0;i<p.npoints();++i)
   {
      if (contains(l,p.pnt(i)))
         if (rel.setdimension(0,1))
	    return(true);
      else
	 if (rel.setdimension(2,1))
	    return(true);
   }

   delete m;
   return (rel.isfalse(0) || rel.isfalse(1) || rel.isfalse(2));
}

bool Relate(const MultiPoint& p,const LineString& l,const char matrix[9])
{
   relmatrix rel(p.dimension(),l.dimension(),matrix);

   if (calc_345678(p,l,rel))
      return(false);
   
   if (rel.unresolved(0) || rel.unresolved(1) || rel.unresolved(2))
      calc_012(p,l,rel);

   return(rel.match());
}

relationship Relate(const MultiPoint& p,const LineString& l)
{
   relmatrix rel(p.dimension(),l.dimension(),"?????????");

   calc_345678(p,l,rel);
   calc_012(p,l,rel);

   return(rel.toRelationship());
}
