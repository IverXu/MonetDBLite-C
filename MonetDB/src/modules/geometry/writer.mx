@f writer
@A C.W. Quak
@h
#ifndef __STRINGWRITER_H__
#define __STRINGWRITER_H__

#include <ctype.h>
#include <strings.h>
#include <stdlib.h>
#include <stdio.h>
#include <math.h>

class StringWriter
{
public:
   char* start;
   size_t len;
   size_t pos;
public:

   StringWriter(char* s,int l);

   void writeString(char* s);
   void writeDouble(double d);

private:
   void makefit(int l);
};
#endif /* __STRINGWRITER_H__ */
@C
#include "writer.h"
#include <gdk.h>
#include <stdlib.h>
#include <stdio.h>

StringWriter::StringWriter(char* s,int l)
{
   start = s;
   pos = 0;
   len = l;
}

void StringWriter::writeString(char* s)
{
   makefit(strlen(s));

   pos += sprintf(start + pos,"%s", s);
}

void StringWriter::writeDouble(double d)
{
   makefit(100);

   if (d == floor(d))
      pos += sprintf(start + pos,"%.0f", d);
   else
      pos += sprintf(start + pos,"%f", d);
}

void StringWriter::makefit(int l)
{
    if (pos + l <= len)
       return;
   
    len = len + len + l;
    start = (char *)GDKrealloc(start,len);
}
